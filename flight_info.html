<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datos del Vuelo - Sistema de Seguridad Operacional</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">✈</div>
            <div>
                <h1>Sistema de Reportes de Seguridad Operacional</h1>
                <p>Registro de Eventos y Peligros</p>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Barra de progreso -->
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-text">Paso 5 de 6: Información del Vuelo</div>
        </div>

        <!-- Card con datos básicos del vuelo -->
        <div class="card">
            <div class="card-header">
                <h2>Datos Básicos del Vuelo</h2>
                <p>Complete la información específica del vuelo relacionado con el evento reportado</p>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>Información del Vuelo:</strong> Proporcione los datos disponibles. Los campos marcados con * son obligatorios.
                </div>

                <form id="flightDetailsForm">
                    <div class="form-grid">

                         <div class="form-group">
                            <label for="flightDate">Fecha del Vuelo <span class="required">*</span></label>
                            <input type="date" id="flightDate" name="flightDate" required>
                            <span class="error-message" id="flightDateError"></span>
                        </div>

                        <div class="form-group">
                            <label for="flightTime">Hora del Evento (Local)</label>
                            <input type="time" id="flightTime" name="flightTime" placeholder="HH:MM">
                            <span class="error-message" id="flightTimeError"></span>
                        </div>
                        <div class="form-group">
                            <label for="flightNumber">Número de Vuelo <span class="required">*</span></label>
                            <input type="text" id="flightNumber" name="flightNumber" required 
                                   placeholder="Ejemplo: AV123, LA456" 
                                   pattern="^[A-Z]{2}[0-9]{1,4}$"
                                   maxlength="8">
                            <span class="error-message" id="flightNumberError"></span>
                        </div>

                        <div class="form-group">
                            <label for="aircraftRegistration">Matrícula de la Aeronave <span class="required">*</span></label>
                            <input type="text" id="aircraftRegistration" name="aircraftRegistration" required 
                                   placeholder="Ejemplo: HK-1234X" 
                                   pattern="^[A-Z]{2}-[A-Z0-9]{4,5}$"
                                   maxlength="10">
                            <span class="error-message" id="aircraftRegistrationError"></span>
                        </div>

                        <div class="form-group">
                            <label for="origin">Aeropuerto de Origen <span class="required">*</span></label>
                            <input type="text" id="origin" name="origin" required 
                                   placeholder="Código IATA: BOG, MDE, CLO..." 
                                   pattern="^[A-Z]{3}$"
                                   maxlength="3">
                            <span class="error-message" id="originError"></span>
                        </div>

                        <div class="form-group">
                            <label for="destination">Aeropuerto de Destino <span class="required">*</span></label>
                            <input type="text" id="destination" name="destination" required 
                                   placeholder="Código IATA: BOG, MDE, CLO..." 
                                   pattern="^[A-Z]{3}$"
                                   maxlength="3">
                            <span class="error-message" id="destinationError"></span>
                        </div>

                       

                       <!--

                        <div class="form-group">
                            <label for="flightPhase">Fase de Vuelo</label>
                            <select id="flightPhase" name="flightPhase">
                                <option value="">Seleccione una fase</option>
                                <option value="pre_flight">Pre-vuelo</option>
                                <option value="taxi_out">Rodaje de salida</option>
                                <option value="takeoff">Despegue</option>
                                <option value="climb">Ascenso</option>
                                <option value="cruise">Crucero</option>
                                <option value="descent">Descenso</option>
                                <option value="approach">Aproximación</option>
                                <option value="landing">Aterrizaje</option>
                                <option value="taxi_in">Rodaje de llegada</option>
                                <option value="post_flight">Post-vuelo</option>
                                <option value="ground">En tierra</option>
                            </select>
                        </div>

                        -->

                        
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="backBtn">Regresar</button>
                        <button type="button" class="btn" id="continueBtn" disabled>Continuar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        // --- Inicialización tipo FlightEventForm ---
        function init() {
            const progressFill = document.getElementById('progressFill');
            if (progressFill) progressFill.style.width = '83.33%';
        }

        document.addEventListener('DOMContentLoaded', () => {
            init();
            setupFlightValidation();
            setupButtons();
            setTodayAsDefault();
        });

        function setTodayAsDefault() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('flightDate').value = today;
        }

        // --- Validación y recolección de datos ---
        function setupFlightValidation() {
            const requiredFields = [
                { id: 'flightNumber', pattern: /^[A-Z]{2}[0-9]{1,4}$/i, message: 'Formato: XX123 (2 letras + números)' },
                { id: 'aircraftRegistration', pattern: /^[A-Z]{2}-[A-Z0-9]{4,5}$/i, message: 'Formato: XX-XXXXX' },
                { id: 'origin', pattern: /^[A-Z]{3}$/i, message: 'Código IATA de 3 letras' },
                { id: 'destination', pattern: /^[A-Z]{3}$/i, message: 'Código IATA de 3 letras' },
                { id: 'flightDate', pattern: /.+/, message: 'Fecha requerida' }
            ];

            const optionalFields = [
                { id: 'runway', pattern: /^[0-9]{2}[LRC]?$/i, message: 'Formato: 13L, 31R, 07' }
            ];

            function setupFieldValidation(fields, required = false) {
                fields.forEach(field => {
                    const input = document.getElementById(field.id);
                    const errorSpan = document.getElementById(field.id + 'Error');
                    if (!input || !errorSpan) return;

                    const validate = () => {
                        let value = input.value.trim();
                        if (input.type === 'text' && value) value = value.toUpperCase();
                        input.value = value;

                        if (!required && !value) { errorSpan.textContent=''; errorSpan.style.display='none'; input.classList.remove('invalid'); return true; }
                        if (required && !value) { errorSpan.textContent='Campo requerido'; errorSpan.style.display='block'; input.classList.add('invalid'); return false; }
                        if (value && !field.pattern.test(value)) { errorSpan.textContent=field.message; errorSpan.style.display='block'; input.classList.add('invalid'); return false; }

                        errorSpan.textContent='';
                        errorSpan.style.display='none';
                        input.classList.remove('invalid');
                        return true;
                    };

                    input.addEventListener('input', validate);
                });
            }

            setupFieldValidation(requiredFields, true);
            setupFieldValidation(optionalFields, false);
        }

        // --- Botones ---
        function setupButtons() {
            const continueBtn = document.getElementById('continueBtn');
            const backBtn = document.getElementById('backBtn');
            continueBtn.disabled = false; // solo ejemplo: activamos directamente

            continueBtn.addEventListener('click', () => {
                window.location.href = 'reporter_info.html';
            });
            backBtn.addEventListener('click', () => {
                window.history.back();
            });
        }
    </script>
</body>
</html>